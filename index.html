<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Kinvey BaaS</title>
<meta name="author" content="(Martin Apostolov)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/theme/night.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Kinvey BaaS</h1><h2 class="author">Martin Apostolov</h2><p class="date">Created: 2019-11-27 Wed 16:17</p>
</section>

<section>
<section id="slide-orge828225">
<h2 id="orge828225">Overview of Kinvey product</h2>
<div class="outline-text-2" id="text-orge828225">
</div>
</section>
<section id="slide-org7d6f82d">
<h3 id="org7d6f82d">What is Kinvey</h3>
<p>
Kinvey is a serverless development platform. It provides Backend As a Service which means that developers would not require to build and maintain a backend for their apps. 
</p>

<p>
Key features:
</p>
<ul>
<li>user management</li>
<li>storing data in the cloud</li>
<li>file storage</li>
<li>integration with external data source</li>

</ul>
</section>
<section id="slide-org735b112">
<h3 id="org735b112">Kinvey Console</h3>
<p>
Kinvey Console is the web-based GUI that allows you to manage most aspects of your Kinvey backend.
</p>

<p target="_blank">
URL: <a href="https://jci-us1-console.kinvey.com" target="_blank">https://jci-us1-console.kinvey.com</a>
</p>
</section>
<section id="slide-orgecf9012">
<h3 id="orgecf9012">Kinvey DevCenter</h3>
<p>
Whenever you have questions, you can refer to Kinvey devcenter for detailed documentation of all features.
</p>

<p target="_blank">
URL: <a href="https://devcenter.kinvey.com/" target="_blank">https://devcenter.kinvey.com/</a>
</p>
</section>
</section>
<section>
<section id="slide-orga7ed325">
<h2 id="orga7ed325">Kinvey Features</h2>
</section>
</section>
<section>
<section id="slide-orgb44135f">
<h2 id="orgb44135f">Apps &amp; Environments</h2>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Apps</td>
<td class="org-left">A backend app contains all components (data, authentication, server-side logic, etc.). It can be used/connected to multiple frontent apps.</td>
</tr>

<tr>
<td class="org-left">Environments</td>
<td class="org-left">A backend app can have multiple environments to support the development lifecycle: Development, Staging, Production</td>
</tr>
</tbody>
</table>

<p>
Each environment has a uniqu ID calld KID (Kinvey ID) which starts with `kid_&#x2026;`
<img src="./images/kid.png" alt="kid.png" />
</p>
</section>
</section>
<section>
<section id="slide-orgfc83adf">
<h2 id="orgfc83adf">REST API</h2>
<p>
 Host: <a href="https://jsi-us1-baas.kinvey.com">https://jsi-us1-baas.kinvey.com</a> <br />
 All reqeuest require authentication <br />
<br />
 <b>Basic</b> Authentication
</p>
<div class="org-src-container">

<pre  class="src src-text"><code trim>Auth string (before encoding in base64): Basic kid_xxx:masterSecret
Auth string (before encoding in base64): Basic kid_xxx:appSecret

Auth string (after base64 encoding): Basic bXlVc2VybmFtZTpteVBhc3N3b3Jk

Authorization: Basic bXlVc2VybmFtZTpteVBhc3N3b3Jk
</code></pre>
</div>
<p>
<br />
  <b>Session</b> Authentication
</p>
<pre  class="example">
Authorization: Kinvey 0a8368d7-cbb8...
</pre>
<p>
<br />
</p>
<p target="_blank">
Docs - <a href="https://devcenter.kinvey.com/rest/guides/authentication" target="_blank">https://devcenter.kinvey.com/rest/guides/authentication</a>
</p>
</section>
</section>
<section>
<section id="slide-org49bee23">
<h2 id="org49bee23">Users</h2>
<p>
Creating a user
</p>
<pre  class="example">
POST /user/:appKey/
Host: baas.kinvey.com
Authorization: [Basic Auth with app credentials]
Content-Type: application/json

{
 "username": "ivan",
 "password": "123456",
 "city": "Boston"
}
</pre>

<p>
Logging a user
</p>
<pre  class="example">
POST /user/:appKey/login
Host: baas.kinvey.com
Content-Type: application/json
Authorization: [Basic Auth with app credentials]

{
  "username": "ivan",
  "password": "123456"
}
</pre>

<p target="_blank">
Docs - <a href="https://devcenter.kinvey.com/rest/guides/users" target="_blank">https://devcenter.kinvey.com/rest/guides/users</a>
</p>
</section>
<section id="slide-orgdde4162">
<h3 id="orgdde4162">Creating a user in Node.js</h3>
<div class="org-src-container">

<pre  class="src src-js"><code trim><span style="color: #C678DD;">var</span> <span style="color: #E06C75;">request</span> = require<span style="color: #61AFEF;">(</span><span style="color: #98C379;">"request"</span><span style="color: #61AFEF;">)</span>;

<span style="color: #C678DD;">var</span> <span style="color: #E06C75;">options</span> = <span style="color: #61AFEF;">{</span>
  method: <span style="color: #98C379;">"POST"</span>,
  url: <span style="color: #98C379;">"https://baas.kinvey.com/user/kid_HJdVi4iZS"</span>,
  headers: <span style="color: #98C379;">{</span>Authorization: <span style="color: #98C379;">'Basic a2lkX0hKZFZpN....'</span><span style="color: #98C379;">}</span>,
  body: <span style="color: #98C379;">{</span>username: <span style="color: #98C379;">"ivan"</span>, password: <span style="color: #98C379;">"123456"</span>, city: <span style="color: #98C379;">"Boston"</span><span style="color: #98C379;">}</span>,
  json: <span style="color: #56B6C2;">true</span>
<span style="color: #61AFEF;">}</span>;

request<span style="color: #61AFEF;">(</span>options, <span style="color: #C678DD;">function</span><span style="color: #98C379;">(</span><span style="color: #E06C75;">error</span>, <span style="color: #E06C75;">response</span>, <span style="color: #E06C75;">body</span><span style="color: #98C379;">)</span> <span style="color: #98C379;">{</span>
  <span style="color: #C678DD;">if</span> <span style="color: #D19A66;">(</span>error<span style="color: #D19A66;">)</span> <span style="color: #C678DD;">throw</span> <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Error</span><span style="color: #D19A66;">(</span>error<span style="color: #D19A66;">)</span>;

  console.log<span style="color: #D19A66;">(</span>body<span style="color: #D19A66;">)</span>;
<span style="color: #98C379;">}</span><span style="color: #61AFEF;">)</span>;
</code></pre>
</div>

</section>
<section id="slide-org5b2e096">
<h3 id="org5b2e096">Logging a user in Node.js</h3>
<div class="org-src-container">

<pre  class="src src-js"><code trim><span style="color: #C678DD;">var</span> <span style="color: #E06C75;">request</span> = require<span style="color: #61AFEF;">(</span><span style="color: #98C379;">"request"</span><span style="color: #61AFEF;">)</span>;

<span style="color: #C678DD;">var</span> <span style="color: #E06C75;">options</span> = <span style="color: #61AFEF;">{</span>
  method: <span style="color: #98C379;">"POST"</span>,
  url: <span style="color: #98C379;">"https://baas.kinvey.com/user/kid_HJdVi4iZS/login"</span>,
  headers: <span style="color: #98C379;">{</span>Authorization: <span style="color: #98C379;">'Basic a2lkX0hKZFZpNGlaU...'</span><span style="color: #98C379;">}</span>,
  body: <span style="color: #98C379;">{</span> username: <span style="color: #98C379;">"ivan"</span>, password: <span style="color: #98C379;">"123456"</span> <span style="color: #98C379;">}</span>,
  json: <span style="color: #56B6C2;">true</span>
<span style="color: #61AFEF;">}</span>;

request<span style="color: #61AFEF;">(</span>options, <span style="color: #C678DD;">function</span><span style="color: #98C379;">(</span><span style="color: #E06C75;">error</span>, <span style="color: #E06C75;">response</span>, <span style="color: #E06C75;">body</span><span style="color: #98C379;">)</span> <span style="color: #98C379;">{</span>
  <span style="color: #C678DD;">if</span> <span style="color: #D19A66;">(</span>error<span style="color: #D19A66;">)</span> <span style="color: #C678DD;">throw</span> <span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Error</span><span style="color: #D19A66;">(</span>error<span style="color: #D19A66;">)</span>;

  console.log<span style="color: #D19A66;">(</span>body<span style="color: #D19A66;">)</span>;
<span style="color: #98C379;">}</span><span style="color: #61AFEF;">)</span>;
</code></pre>
</div>
</section>
<section id="slide-org97a0b07">
<h3 id="org97a0b07">Important notes</h3>
<ol>
<li>Passing empty body when creating a new user will result in the `username` and `password` being auto-generated.</li>
<li>By default the issued user session tokens do not expire. You can add expiration through <b>Console</b> &rarr; <b>App settings</b> &rarr; <b>User session timeout</b></li>

</ol>
</section>
</section>
<section>
<section id="slide-org6b3d22a">
<h2 id="org6b3d22a">Collections</h2>
<p>
Creating a collection
</p>
<ol>
<li>Through Kinvey Console</li>
<li>Making a POST request to a non-existing collection would create the collection first before adding a file to it</li>

</ol>
</section>
<section id="slide-org531dec1">
<h3 id="org531dec1">CRUD opeartions</h3>
<p>
Kinvey supports CRUD operations (Create, Read, Update, Delete) by making a requests to the following url for collections: 
</p>
<pre  class="example">
URL: /appdata/:appKey/:collectionName
</pre>

<p target="_blank">
Docs - <a href="https://devcenter.kinvey.com/rest/guides/datastore" target="_blank">https://devcenter.kinvey.com/rest/guides/datastore</a>
</p>
</section>
<section id="slide-orgeb41063">
<h3 id="orgeb41063">Differences between relatinal and NoSQL databases</h3>
<p>
Kinvey uses MongoDB which is a NoSQL database. A NoSQL databse stores data as key-value pairs. 
</p>

<div class="org-src-container">

<pre  class="src src-json"><code trim><span style="color: #61AFEF;">{</span>
  <span style="color: #C678DD;">"_id"</span>: ObjectId<span style="color: #98C379;">(</span><span style="color: #98C379;">"5099803df3f4948bd2f98391"</span><span style="color: #98C379;">)</span>,
  <span style="color: #C678DD;">"name"</span>: <span style="color: #98C379;">{</span> <span style="color: #C678DD;">"first"</span>: <span style="color: #98C379;">"Alan"</span>, <span style="color: #C678DD;">"last"</span>: <span style="color: #98C379;">"Turing"</span> <span style="color: #98C379;">}</span>,
  <span style="color: #C678DD;">"city"</span>: <span style="color: #98C379;">"Boston"</span>,
  <span style="color: #C678DD;">"contribs"</span>: <span style="color: #98C379;">[</span><span style="color: #98C379;">"Turing machine"</span>, <span style="color: #98C379;">"Turing test"</span>, <span style="color: #98C379;">"Turingery"</span><span style="color: #98C379;">]</span>,
  <span style="color: #C678DD;">"views"</span>:<span style="color: #56B6C2;">125</span>
<span style="color: #61AFEF;">}</span>
</code></pre>
</div>

<p class="verse">
Kinvey uses MongoDB which is a NoSQL database. A NoSQL databse stores data as key-value pairs.<br />
NoSQL database has no schema (like relational).<br />
NoSQL does not require <b>Normalized Data</b>. There are even benefits when using <b>Denormalized data</b>.<br />
</p>

<p target="_blank">
Docs - <a href="https://devcenter.kinvey.com/rest/guides/data-modeling" target="_blank">https://devcenter.kinvey.com/rest/guides/data-modeling</a>
</p>
</section>
</section>
<section>
<section id="slide-orgd094ccd">
<h2 id="orgd094ccd">Files</h2>
<p style="text-align:left">
<b>Uploading files</b>
Kinvey stores files in a third-party service - currently Google Cloud Storage. <br />
Uploading to Kinvey is a two-step process:
</p>
<ol>
<li>Upload file metadata to Kinvey</li>
<li>Upload file data to Google Cloud storage</li>

</ol>
<p>
<br />
<br />
</p>
<p target="_blank">
Docs - <a href="https://devcenter.kinvey.com/rest/guides/files" target="_blank">https://devcenter.kinvey.com/rest/guides/files</a>
</p>
</section>
<section id="slide-org81b7f58">
<h3 id="org81b7f58">Upload metadata important notes</h3>
<ol>
<li>File content type: Note that you would set an "X-Kinvey-Content-Type" header if you want to set the content type to Google Cloud Storage.</li>
<li>Public/Private files:
<ul>
<li>When uploading the file as <b>public: true</b>, in the first request's response you would receive not only the <b>_uploadURL</b> but also <b>_requiredHeaders</b> which should be included in the second request as headers.</li>
<li>When uploading the file as <b>public:false</b>, the response would return an empty <b>_requiredHeaders</b> property, so NO additional headers should be included in the second request, otherwise it would result in an error response.</li>

</ul></li>

</ol>
</section>
<section id="slide-org4efc065">
<h3 id="org4efc065">Upload file sample request</h3>
<p>
<b>Upload file metadata</b>
</p>
<pre  class="example">
      POST /blob/:appKey HTTP/1.1
      Content-Type: application/json
      X-Kinvey-Content-Type: image/png
      Authorization: [user credentials]
   ​
     {
        "_filename": "some-file-name",
        "_public": true
     }
</pre>

<p>
<b>Upload file data</b>
</p>
<pre  class="example">
      PUT _uploadURL
      Content-Type: image/png
      _requiredHeaders // ONLY if received by previous call
   ​
      Body:
      binary file here
</pre>
</section>
</section>
<section>
<section id="slide-org0bb88e7">
<h2 id="org0bb88e7">Services</h2>
<p class="verse">
Services are objects that can be shared between Environemnts in an App or between Apps in an Organization.<br />
Services include:<br />
</p>

<ul>
<li><b>Mobile Identity Connect</b> (MIC) - bridges mobile applications with existing enterprise identity and single sign-on solutions</li>
<li><b>Flex</b> - low-code, lightweight Node.js microservices for adding server-side code</li>
<li><b>RAPID</b> - connect to existing enterprise external data (like relational Database or external REST API)</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgcf8f8da">
<h2 id="orgcf8f8da">Serverside Code</h2>
<p>
Serverside code is mainly used to create logic that is executed as a <b>collection hook</b> (before or after a request to a collection is made) or to a <b>custom endpiont</b> - a logic that has its own endpiont to be called and be executed.
<img src="./images/kinvey_request.png" alt="kinvey_request.png" /> 
</p>

<ul>
<li>Business Logic - writing server side logic (collection hooks and custom endpints) right inside Kinvey Console. It is preferable to use Flex instead of Business Logic.</li>
<li>Flex - create a Node.js microservice that you can deploy to Kinvey.</li>
<li>Scheduled code - execute custom endpionts on predefined intervals</li>

</ul>
</section>
</section>
<section>
<section id="slide-org6303de6">
<h2 id="org6303de6">Flex</h2>
<p>
Kinvey Flex is a more feature-rich and flexible way to write server-side code for your apps compared to Business Logic. <br />
Flex has three flavors: data integration services, authentication services, and general-purpose functions.
</p>

<p>
<br />
Prerequisites:  
</p>
<ol>
<li>install NPM (Node Package Manager)</li>
<li>install Kinvey CLI - <a href="https://github.com/Kinvey/kinvey-cli">https://github.com/Kinvey/kinvey-cli</a></li>

</ol>

<p>
<br />
</p>
<p target="_blank">
Docs - <a href="https://devcenter.kinvey.com/rest/guides/flexservice-runtime" target="_blank">https://devcenter.kinvey.com/rest/guides/flexservice-runtime</a>
</p>
</section>
<section id="slide-org348387c">
<h3 id="org348387c">Create Flex Service in Kinvey Console</h3>
<p>
Before you can deploy your Node.js project, you need to provision a Flex service using the Kinvey Console.
<br />
<br />
Docs - <a href="https://devcenter.kinvey.com/rest/guides/flexservice-runtime#creating-an-internal-flex-service">https://devcenter.kinvey.com/rest/guides/flexservice-runtime#creating-an-internal-flex-service</a>
</p>
</section>
<section id="slide-org7501b38">
<h3 id="org7501b38">Initialize a Node.js project</h3>
<div class="org-src-container">

<pre  class="src src-shell"><code trim>mkdir <span style="color: #98C379;">'myProject'</span>
<span style="color: #56B6C2;">cd</span> <span style="color: #98C379;">'myProject'</span>
npm init
npm install kinvey-flex-sdk
touch index.js
</code></pre>
</div>
</section>
<section id="slide-orgea18532">
<h3 id="orgea18532">Initialize the Flex SDK inside index.js</h3>
<div style="font-size: 90%;">
<div class="org-src-container">

<pre  class="src src-js"><code trim><span style="color: #C678DD;">const</span> <span style="color: #E06C75;">sdk</span> = require<span style="color: #61AFEF;">(</span><span style="color: #98C379;">"kinvey-flex-sdk"</span><span style="color: #61AFEF;">)</span>;

sdk.service<span style="color: #61AFEF;">(</span><span style="color: #98C379;">{}</span>, <span style="color: #C678DD;">function</span><span style="color: #98C379;">(</span><span style="color: #E06C75;">err</span>, <span style="color: #E06C75;">flex</span><span style="color: #98C379;">)</span> <span style="color: #98C379;">{</span>
  <span style="color: #C678DD;">if</span> <span style="color: #D19A66;">(</span>err<span style="color: #D19A66;">)</span> <span style="color: #D19A66;">{</span>
    console.log<span style="color: #56B6C2;">(</span>err<span style="color: #56B6C2;">)</span>;
  <span style="color: #D19A66;">}</span>

  console.log<span style="color: #D19A66;">(</span><span style="color: #98C379;">`===&gt; Flex Service started (SDK v${flex.version})`</span><span style="color: #D19A66;">)</span>;

  <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Define a function to execute</span>
  <span style="color: #C678DD;">function</span> <span style="color: #61AFEF;">logTime</span><span style="color: #D19A66;">(</span><span style="color: #E06C75;">context</span>, <span style="color: #E06C75;">complete</span>, <span style="color: #E06C75;">modules</span><span style="color: #D19A66;">)</span> <span style="color: #D19A66;">{</span>
    console.log<span style="color: #56B6C2;">(</span><span style="color: #C678DD;">new</span> <span style="color: #E5C07B;">Date</span><span style="color: #C678DD;">()</span><span style="color: #56B6C2;">)</span>;
    complete<span style="color: #56B6C2;">()</span>
      .ok<span style="color: #56B6C2;">()</span>
      .done<span style="color: #56B6C2;">()</span>;
  <span style="color: #D19A66;">}</span>
  <span style="color: #5C6370; font-style: italic;">// </span><span style="color: #5C6370; font-style: italic;">Register the logTime function as a Flex function</span>
  flex.functions.register<span style="color: #D19A66;">(</span><span style="color: #98C379;">"logTime"</span>, logTime<span style="color: #D19A66;">)</span>;
<span style="color: #98C379;">}</span><span style="color: #61AFEF;">)</span>;
</code></pre>
</div>
</section>
<section id="slide-org15e02ef">
<h3 id="org15e02ef">Configure Kinvey CLI for deploy</h3>
<p>
Configure Kinvey CLI so that it can access Kinvey Console with your credentials
</p>
<div class="org-src-container">

<pre  class="src src-shell"><code trim>$ kinvey init
? E-mail john.doe@kinvey.com
? Password ***********
? Instance ID <span style="color: #61AFEF;">(</span>optional<span style="color: #61AFEF;">)</span> jci-us1
? Profile name dev
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-shell"><code trim><span style="color: #56B6C2;">cd</span> &lt;node.js project dir&gt;
kinvey flex init
</code></pre>
</div>
</section>
<section id="slide-orgb9059a2">
<h3 id="orgb9059a2">Deploy to Kinvey</h3>
<div class="org-src-container">

<pre  class="src src-shell"><code trim><span style="color: #56B6C2;">cd</span> &lt;node.js project dir&gt;
kinvey flex deploy

<span style="color: #5C6370; font-style: italic;"># </span><span style="color: #5C6370; font-style: italic;">check the status of the service/deploy</span>
kinvey flex status

<span style="color: #5C6370; font-style: italic;"># </span><span style="color: #5C6370; font-style: italic;">check service logs</span>
kinvey flex logs
</code></pre>
</div>

<p target="_blank">
Docs - <a href="https://devcenter.kinvey.com/rest/guides/flexservice-runtime#ManagingTroubleshootingandTerminatingServices" target="_blank">https://devcenter.kinvey.com/rest/guides/flexservice-runtime#ManagingTroubleshootingandTerminatingServices</a>
</p>
</section>
<section id="slide-orgb13ac39">
<h3 id="orgb13ac39">Check service functions</h3>
<p style="text-align:left">
Go to 
</p>
<pre  class="example">
Kinvey Console -&gt; Services -&gt; your-flex-service -&gt; Service Objects
</pre>
<p style="text-align:left">
You should be able to see the registered Flex functions (logTime in our case)
</p>

<p>
<br />
</p>
<p style="text-align:left">
Go to 
</p>
<pre  class="example">
Kinvey Console -&gt; your-app -&gt; Custom Endpoint 
</pre>
<p style="text-align:left">
Create a new endpoint and choose <b>Microservice</b> and then your Flex service and flex function.
</p>

<p>
<br />
</p>
<p style="text-align:left">
Make a request to:
</p>
<pre  class="example">
POST /rpc/:kid/custom/your-custom-endpoint
</pre>
</section>
</section>
<section>
<section id="slide-org5f69103">
<h2 id="org5f69103">Security</h2>
<ul>
<li>Collection permissions</li>
<li>Entity permissions</li>

</ul>
</section>
</section>
<section>
<section id="slide-org5e83cc7">
<h2 id="org5e83cc7">Mobile Identity Connect</h2>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
width:1200, height:800, margin: 0.2, minScale:0.2, maxScale:3.5, hash:true, history:true, controlsTutorial:true,
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
